\chapter{Синтез оптимального управления}
% ==============================================================================================
\newcommand{\funcF}{ \calf{F}           } % функция качества
\newcommand{\optF}{  \optimum{\funcF}   } % оптимальная функция F
\newcommand{\optU}{  \optimum{u}        } % оптимальное управление u
\newcommand{\optX}{  \optimum{x}        } % оптимальная траектория x
\newcommand{\funcL}{ \sff{L}            } % функция Лагранжа
\newcommand{\funcT}{ \optimum{\sff{F}}  } % передаточная функция F
\newcommand{\funcV}{ \sff{V}            } % функция Ляпунова
\newcommand{\funcH}{ \optimum{H}        } % функция Гамильтона

\newcommand{\mA}{    \bff{A}            } % матрица A
\newcommand{\mB}{    \bff{B}            } % матрица B
\newcommand{\mM}{    \bff{M}            } % матрица M
\newcommand{\mQ}{    \bff{Q}            } % матрица Q
\newcommand{\mR}{    \bff{R}            } % матрица R
\newcommand{\mP}{    \bff{P}            } % матрица P
\newcommand{\mH}{    \bff{H}            } % матрица H
\newcommand{\mD}{    \bff{D}            } % матрица D
\newcommand{\mC}{    \bff{C}            } % матрица C
\newcommand{\mLa}{   \bff{\Lambda}      } % матрица Лямбда
\newcommand{\mI}{    \bff{I}            } % единичная матрица I
\newcommand{\mb}{    \bff{b}            } % матрица-вектор b
\newcommand{\mk}{    \bff{k}            } % матрица-вектор k
% ==============================================================================================




% **********************************************************************************************
\section{Принцип Беллмана}
% **********************************************************************************************



Рассмотрим следующую задачу Лагранжа. Для системы $\dot{x} = f(x, u, t)$, начинающей движение из начального состояния $x(t_1) = x_1$, найдем управление $u(t)$, ограниченное некоторым допустимым классом функций $\Omega(t)$ и определенное на интервале времени $[t_1, t_2]$, которое минимизирует показатель качества

\beq{eq:2/1/1}
    \funcF = \int\limits_{t_1}^{t_2} \funcL(x, u, t)\,dt \mbox{,}
\eeq

где функция $\funcL(x, u, t)$ предполагается непрерывной по $t$. Конечное состояние $x(t_2) = x_2$ не задано. Все функции, принадлежащие $\Omega(t)$ ограничены по амплитуде в любой момент времени $t$: $|u_j(t)| \leqslant V_j$. Множество точек $|u_j(t)| \leqslant V_j$ ($j = 1, 2, \ldots, n$) будем обозначать как $\Upsilon$.

Показатель качества $\funcF$ для фиксированного значения $t_2$ зависит от переменных $u(t)$, $x_1$ и $t_1$. Однако оптимальное значение функционала $\funcF$ зависит лишь от начального состояния $x_1$ и момента времени $t_1$. Обозначим оптимальное значение этого функционала как $\optF(x_1, t_1)$. Если поставлена задача оптимального управления, то для каждой точки $x_1$ ставится в соответствие некоторое значение критерия оптимальности. Функция $\optF(x_1, t_1)$ определяет гиперповерхность в $n+1$-мерном пространстве. Эта гиперповерхность, конечно, в явном виде не задана, но некоторые ее свойства позволяют вывести ряд необходимых условий, которым должна удовлетворять функция оптимального управления $\optU(t)$.

Обозначим через $x \bigl( u(t), t \bigr)$ траекторию, которая получается в результате воздействия управления $u(t)$ на систему $\dot{x} = f(x, u, t)$ с начальным состоянием $x_1$ в момент времени $t = t_1$. При этом $\optF$ определяется выражением

\beq{eq:2/1/2}
    \optF(x_1, t_1) = \underset{\substack{u(t) \in \Omega(t) \\ t_1 \leqslant t \leqslant t_2}}{\min} \biggl\{ \int\limits_{t_1}^{t_2} \funcL\bigl(x(u, t), u, t\bigr)\,dt \biggr\} \mbox{.}
\eeq

Для некоторого момента времени $t'$ из интервала между $t_1$ и $t_2$ это выражение можно написать в таком виде:

\beq{eq:2/1/3}
    \optF(x_1, t_1) = \underset{\substack{u(t) \in \Omega(t) \\ t_1 \leqslant t \leqslant t_2}}{\min} \biggl\{ \int\limits_{t_1}^{t'} \funcL\bigl(x(u, t), u, t\bigr)\,dt + \int\limits_{t'}^{t_2} \funcL\bigl(x(u, t), u, t\bigr)\,dt \biggr\} \mbox{.}
\eeq

Уравнение~\ref{eq:2/1/3} позволяет применить для его решения принцип оптимальности. Для случая непрерывных систем принцип оптимальности можно сформулировать следующим образом.

\begin{statement}\lbl{statement:1}
	Оптимальное управление $\optU(t)$ на интервале времени $[t_1, t_2]$ имеет следующее свойство: для любого $t'$, заключенного в интервале $t_1 < t' < t_2$ независимо от значений, которые управление $\optU(t)$ принимало на интервале времени $[t_1, t']$, и, следовательно, независимо от значения $\optX(t')$ оно должно оставаться оптимальным управлением относительно состояния $\optX(t')$ на интервале времени $(t', t_2]$.
\end{statement}

Применяя этот принцип, уравнение~\ref{eq:2/1/3} можно преобразовать к следующему виду

\beq{eq:2/1/4}
    \optF(x_1, t_1) = \underset{\substack{u(t) \in \Omega(t) \\ t_1 \leqslant t \leqslant t'}}{\min} \biggl\{ \int\limits_{t_1}^{t'} \funcL\bigl(x(u, t), u, t\bigr)\,dt + \optF\bigl(x(t'), t'\bigr) \biggr\} \mbox{,}
\eeq

где $x(t')$~--- конечное состояние, которое является результатом действия управления $u(t)$ на интервале времени $[t_1, t']$\footnote{ Если предположить, что функция $\funcF$ имеет непрерывные частные производные по $x$ и $t$, можно легко прийти к уравнению Беллмана (см TODO). Однако, как будет показано ниже, это предположение не выполняется для большого класса задач оптимального управления. В приводимом здесь доказательстве, основанном на работе TODO, это предположение не используется }.

При оптимальном управлении $u(t) = \optU(t)$ на интервале $[t_1, t']$ имеем

\beq{eq:2/1/5}
    \optF(x_1, t_1) = \int\limits_{t_1}^{t'} \funcL\bigl(x(\optU, t), \optU(t), t\bigr)\,dt + \optF\bigl(x(t'), t'\bigr) \mbox{.}
\eeq

Перенося члены и деля на $t' - t_1$ получим

\beq{eq:2/1/6}
    -\frac{\optF\bigl( x(t'), t' \bigr) - \optF( x_1, t_1)}{t' - t_1} = \frac{1}{t' - t_1} \int\limits_{t_1}^{t'} \funcL\bigl(x(\optU, t), \optU(t), t\bigr)\,dt \mbox{.}
\eeq

При $t' \to t_1$ уравнение~\ref{eq:2/1/6} принимает вид

\beq{eq:2/1/7}
    \lim_{t' \to t_1} \biggr[ -\frac{\optF\bigl( x(t'), t' \bigr) - \optF( x_1, t_1)}{t' - t_1} \biggr] = \funcL\bigl(x_1, \optU(t_1), t_1\bigr) \mbox{.}
\eeq

Заметим, что для получения правой части выражения~\ref{eq:2/1/7} как предела правой части уравнения~\ref{eq:2/1/6} используется теорема о среднем значении (TODO). Если предел левой части уравнения~\ref{eq:2/1/7} существует, то можно определить величину

\beq{eq:2/1/8}
    \biggl[ \genericdiff{\optF}{t} \biggr]_{\optU, t_1} \eqdef \lim_{t' \to t_1} \biggr[ -\frac{\optF\bigl( x(t'), t' \bigr) - \optF( x_1, t_1)}{t' - t_1} \biggr] \mbox{.}
\eeq

Величина $[ \genericlinediff{\optF}{t} ]_{\optU, t_1}$ есть производная функции $\optF$ по времени, вычисленная в момент времени $t_1$. Анализируя правую часть выражения~\ref{eq:2/1/8}, можно видеть, что производную следует вычислять вдоль траектории, обусловленной управлением $\optU$ и начинающейся в $x_1$. Иными словами, пусть для некоторой задачи функция $\optF(x, t)$ определена для любого начального состояния $x$ и начального момента времени $t$. Пусть $x\bigl( u(t), t \bigr)$ определяет траекторию, обусловленную управлением $u(t)$; тогда вдоль любой из этих траекторий величина $\optF(x, t)$ будет изменяться во времени со скоростью, определяемой величиной $[ \genericlinediff{\optF}{t} ]_{u, t}$. В частности, вдоль оптимальной траектории она будет изменяться со скоростью $[ \genericlinediff{\optF}{t} ]_{\optU, t}$.

Таким образом

\beq{eq:2/1/9}
    \biggl[ \genericdiff{\optF}{t} \biggr]_{\optU, t_1} + \funcL\bigl(x_1, \optU(t_1), t_1\bigr) = 0 \mbox{.}
\eeq

Заметим, что при $u(t) \neq \optU(t)$ для интеграла~\ref{eq:2/1/5} в соответствии с определением должно выполняться неравенство

\beq{eq:2/1/10}
    \optF(x_1, t_1) \leqslant \int\limits_{t_1}^{t'} \funcL\bigl(x(\optU, t), \optU(t), t\bigr)\,dt + \optF\bigl(x(t'), t'\bigr) \mbox{.}
\eeq

Откуда следует, что

\beq{eq:2/1/11}
    \biggl[ \genericdiff{\optF}{t} \biggr]_{u, t_1} + \funcL\bigl(x_1, u(t_1), t_1\bigr) \geqslant 0 \mbox{.}
\eeq

Используя выражения~\vref{eq:2/1/9} и~\ref{eq:2/1/11}, получим

\beq{eq:2/1/12}
    \biggl[ \genericdiff{\optF}{t} \biggr]_{u, t_1} + \funcL\bigl(x_1, u(t_1), t_1\bigr) \geqslant \biggl[ \genericdiff{\optF}{t} \biggr]_{\optU, t_1} + \funcL\bigl(x_1, \optU(t_1), t_1\bigr) \mbox{,}
\eeq

или

\beq{eq:2/1/13}
    \underset{u(t_1) \in \Upsilon}{\min} \biggl\{ \biggl[ \genericdiff{\optF}{t} \biggr]_{u, t_1} + \funcL\bigl(x_1, u(t_1), t_1\bigr) \biggr\} = 0 \mbox{.}
\eeq

Уравнение~\ref{eq:2/1/13} справедливо в любой момент времени из интервала $[t_1, t_2]$, так что для любого момента времени $t$ и любого состояния $x$ на траектории $\optX(t)$, принимая его за начальное, можно написать

\beq{eq:2/1/14}
    \underset{u(t) \in \Upsilon}{\min} \biggl\{ \biggl[ \genericdiff{\optF}{t} \biggr]_{u, t} + \funcL\bigl(x(u, t), u, t\bigr) \biggr\} = 0 \mbox{.}
\eeq

Уравнение~\ref{eq:2/1/14} и есть функциональное уравнение Беллмана в общей форме, выражающее необходимое условие оптимальности.

Для любого состояния $x$ и момента времени $t$, когда функция $\genericlinediff{\optF}{t}$, $\genericlinediff{\optF}{x}$ и $f(x, u, t)$ непрерывны по $x$ и $t$, полную производную $[\genericlinediff{\optF}{t}]_{u, t}$ можно записать так:

\beq{eq:2/1/15}
    \biggl[ \genericdiff{\optF}{t} \biggr]_{u, t} = \biggl(\partdiff{\optF}{x}\biggr)^T f(x, u, t) + \partdiff{\optF}{t} \mbox{.}
\eeq

Так как частная производная $\partlinediff{\optF}{t}$ не зависит от $u$, уравнение \ref{eq:2/1/14} можно представить в виде

\beq{eq:2/1/16}
    - \partdiff{\optF}{t} = \underset{u(t) \in \Upsilon}{\min} \Biggl\{ \funcL\bigl(x(u, t), u, t\bigr) + \biggl(\partdiff{\optF}{x}\biggr)^T f(x, u, t) \Biggr\} \mbox{.}
\eeq

В тех случаях, когда это уравнение применимо, оно обеспечивает необходимое условие оптимальности. Отметим, что оно является необычной формой дифференциального уравнения в частных производных, которое включает операцию минимизации. Это, в общем случае нелинейное, дифференциальное уравнение в частных производных первого порядка относительно одной переменной $\optF$. Это уравнение определяет одноточечную краевую задачу с граничным условием вида

\beq{eq:2/1/17}
    \lim_{t_1 \to t_2} \optF(x_1, t_1) = \lim_{t_1 \to t_2} \int\limits_{t_1}^{t_2} \funcL(\optX, \optU, t)\,dt = 0 \mbox{.}
\eeq

Очевидно, это условие соответствует двум.

\benum
    \item
        Оно указывает, как следует вести поиск оптимальной $u(t)$: в любой момент времени $t$ поиск должен быть таким, чтобы минимизировать величину, заключенную в квадратные скобки в уравнении~\vref{eq:2/1/16}.

    \item
        Если функция оптимального управления $\optU(t)$ найдена, то~\ref{eq:2/1/16} сводится к уравнению без операции минимизации
        \beq{eq:2/1/18}
            - \partdiff{\optF}{t} = \funcL\bigl(x(\optU(t), t), \optU, t\bigr) + \biggl(\partdiff{\optF}{x}\biggr)^T f(x(\optU(t), t), \optU, t) \mbox{,}
        \eeq 
        которому удовлетворяет функция $\optF(x, t)$ для всех значений $t$ в интервале $[t_1, t_2]$.
\eenum

При отсутствии ограничений на величину $u$ и при условии, что функции $\funcL$ и $f$ имеют частные производные по $u$, оптимальное управление $\optU(t)$ можно найти путем дифференцирования выражения, заключенного в квадратные скобки в уравнении~\ref{eq:2/1/16} и приравнивания полученного результата к нулю. Это дает условие

\beq{eq:2/1/19}
    \biggl[ \partdiff{\funcL}{u} + \sum\limits_{i=1}^n \partdiff{\optF}{x_i} \centerdot \partdiff{f_i}{u} \biggr] = 0 \mbox{ для всех } t \in [t_1, t_2] \mbox{.}
\eeq

Если показатель качества соответствует задаче Майера, а именно $\funcF = P\bigl( x(t_2), t_2 \bigr)$, то, придерживаясь тех же рассуждений, получим соответствующее уравнение Беллмана

\beq{eq:2/1/20}
    \underset{u(t) \in \Upsilon}{\min} \Biggl\{ \biggl[ \genericdiff{\optF}{t} \biggr]_{u, t} \Biggr\} = 0
\eeq

с граничным условием

\beq{eq:2/1/21}
    \lim_{t_1 \to t_2} \optF\bigl(x(t_1), t_1\bigr) = P\bigl(x(t_2), t_2\bigr) \mbox{.}
\eeq

В тех же случаях, когда функции $\partlinediff{\optF}{t}$, $\partlinediff{\optF}{x}$ и $f(x, u, t)$ непрерывны по $x$ и $t$, имеем

\beq{eq:2/1/22}
    - \partdiff{\optF}{t} = \underset{u(t) \in \Upsilon}{\min} \Biggl\{ \biggl(\partdiff{\optF}{x}\biggr)^T f(x, u, t) \Biggr\}
\eeq

с тем же граничным условием~\ref{eq:2/1/21}.

\br

Отметим, что тип граничного условия для конечного состояния не играет роли при выводе функционального уравнения. Таким образом, уравнение Беллмана~\ref{eq:2/1/14} или~\vref{eq:2/1/16} справедливо для задачи, даже если конечное состояние $x_2$ задано, а конечный момент времени $t_2$ нет. Условие~\vref{eq:2/1/17} по-прежнему справедливо, и нет необходимости вносить какие-либо изменения при выводе уравнения Беллмана.



% **********************************************************************************************
\section{Синтез оптимального управления в системах с квадратичным критерием качества}
% **********************************************************************************************



Как было показано в предыдущем разделе, динамическое программирование обладает тем свойством, что оптимальная функция управления $\optU$ обычно записывается в виде функции переменных состояния $x$, и, следовательно, синтезируется система с обратной связью. Однако использование динамического программирования требует решения уравнения Беллмана. Задачу можно решать двумя путями:

\benum
    \item
        Получить $2n$ дифференциальных уравнений с двухточечными граничными условиями с помощью вариационного исчисления или принципа максимума.
        
    \item
        Получить одно дифференциальное уравнение в частных производных с граничными условиями в одной точке
\eenum

Преимущество второго метода над первым не очевидно. Однако есть ряд задач о синтезе регулятора, где второй метод оказывается удобнее и практичнее. Сформулируем следующую задачу\footnote{ Более детально задачи о синтезе регуляторов такого рода рассматривали Калман и Мэрриэм (TODO) }.

Пусть дан линейный нестационарный объект управления, который описывается уравнением $\dot{x} = \mA(t)x + \mB(t)u$ с начальным условием $x(t_1) = x_1$ и с незаданным конечным состоянием $x(t_2)$.. Необходимо найти\footnote{ Необходимость использовать этот критерий возникает в тех случаях, когда требуется существование второй вариации от заданного функционала. } оптимальную функцию управления $\optU(t)$ на интервале $[t_1, t_2]$, минимизирующую функционал

\beq{eq:2/2/1}
    \funcF = \frac{1}{2} x_2^T \mM x_2 + \frac{1}{2} \int\limits_{t_1}^{t_2} \bigl[ x^T(\tau)\mQ(\tau)x(\tau) + u^T(\tau)\mR(\tau)u(\tau) \bigr]\,d\tau \mbox{,}
\eeq

где $\mM \in \Rs{n}{n}$, $\mQ(t) \in \Rs{m}{m}$ и $\mR(t) \in \Rs{n}{n}$~--- симметричные матрицы, причем $\mQ(t)$ и $\mR(t)$ являются положительно определенными и обладают непрерывными вторыми производными по $t$; $\mM$~--- знакоположительная постоянная матрица.

Сформулированная таким образом задача есть задача Больца (TODO). Уравнение Беллмана в этом случае имеет вид

\beq{eq:2/2/2}
    - \partdiff{\optF}{t} = \frac{1}{2} x^T(t)\mQ(t)x(t) + \frac{1}{2} \optU^T(t)\mR(t)\optU(t) + \biggl(\partdiff{\optF}{x}\biggr)^T\bigl( \mA(t)x(t) + \mB(t)\optU(t) \bigr) \mbox{.}
\eeq

Граничное условие, вытекающее из уравнений~\vref{eq:2/1/17} и~\vref{eq:2/1/21}, сводится к

\beq{eq:2/2/3}
    \lim_{t \to t_2} \optF(x, t) = \frac{1}{2} x^T(t_2) \mM x(t_2) \mbox{.}
\eeq

Процесс минимизации приводит к условию (TODO на книжку умную)

\beq{eq:2/2/4}
    \partdiff{\calf{I}}{u} \biggm|_{u = \optU} + \frac{\partial}{\partial u} \Biggl[ \biggl(\partdiff{\optF}{x}\biggr)^T\bigl( \mA(t)x + \mB(t)u \bigr) \Biggr] \Biggm|_{u = \optU} = 0 \mbox{,}
\eeq

где $\calf{I}$~--- подынтегральное выражение в уравнении~\ref{eq:2/2/1}. Из последнего условия следует, что

\beq{eq:2/2/5}
    \optU(t) = -\mR^{-1}(t)\mB^T(t) \partdiff{\optF}{x} \mbox{.}
\eeq

Если хотим синтезировать линейное управление как функцию координат, то следует как критерий качества $\optF$ принять квадратичную форму

\beq{eq:2/2/6}
    \optF(x, t) = \frac{1}{2} x^T\mP(t)x \mbox{,}
\eeq

где $\mP(t) \in \Rs{n}{n}$~--- симметричная матрица.

Подставив выражения~\ref{eq:2/2/5} и~\ref{eq:2/2/6} в уравнение Беллмана~\ref{eq:2/2/2}, получим матричное уравнение Риккати

\beq{eq:2/2/7}
    - \genericdiff{\mP(t)}{t} = -\mP(t)\mB(t)\mR^{-1}(t)\mB^T(t)\mP(t) + \mP(t)\mA(t) + \mA^T(t)\mP(t) + \mQ(t)
\eeq

с граничным условием

\beq{eq:2/2/8}
    \mP(t_2) = \mM \mbox{.}
\eeq

Матрицу $\mP(t)$ теоретически можно найти, интегрируя уравнение~\ref{eq:2/2/7} в обратном времени с начальным условием~\ref{eq:2/2/8}. После нахожденя матрицы $\mP(t)$, так как она симметрична, с помощью выражений~\vref{eq:2/2/5} и~\ref{eq:2/2/6} получим

\beq{eq:2/2/9}
    \optU(x, t) = -\mR^{-1}(t)\mB^T(t)\mP(t)x(t) \mbox{.}
\eeq

Таким образом, единственный абсолютный минимум функционала~\vref{eq:2/2/1} получается только в том случае, если матричное уравнение Риккати имеет одно решение. В отношении последнего Калман (TODO) доказал следующую теорему.

\begin{teo}\lbl{teo:1}
    В соответствии с принятыми предположениями, уравнение~\ref{eq:2/2/7} с граничным условием~\ref{eq:2/2/8} имеет единственное решение для матрицы $\mP(t)$, при этом управление~\ref{eq:2/2/9} является оптимальным по отношению к критерию оптимальности~\vref{eq:2/2/6}.
\end{teo}

Иными словами, уравнение Беллмана~\vref{eq:2/2/2} обеспечивает для этого случая достаточное условие оптимальности.

% TODO то, что дальше, засунуть в описание к задаче про ракету

\br

Калман (TODO) показал, что при $T \to \infty$ для полностью управляемой линейной стационарной системы и показателя качества

\beqn
    \funcF = \frac{1}{2} \int\limits_0^\infty \bigl[ x^T(\tau)\mQ x(\tau) + u^T(t)\mR u(\tau) \bigr]\,d\tau \mbox{,}
\eeqn

где $\mQ$ и $\mR$~--- симметричные, положительно определенные постоянные матрицы, справедливо условие $\lim\limits_{T \to \infty}\dot{\mP}(t) = 0$ и, таким образом, матричное уравнение Риккати~\ref{eq:2/2/7} сводится к нелинейному матричному алгебраическому уравнению

\beq{eq:2/2/10}
    -\mP\mB\mR^{-1}\mB^T\mP + \mP\mA + \mA^T\mP + \mQ = 0 \mbox{.}
\eeq

Решение этого уравнения определяет постоянную матрицу $\mP$. Оптимальное управлерние имеет вид $\optU(x, t) = -\mR^{-1}\mB^T\mP x$. Это уравнение означает, что все переменные состояния должны быть известны, то есть нужно точно измерять выходной сигнал и $n-1$ его производную. Это очень жесткое требование. Применительно к случаю одного управляющего воздействия, Калман (TODO) показал, что если в приведенной выше задаче уравнение~\ref{eq:2/2/10} определяет постоянную матрицу $\mP$, получается строгое решение в частотной области.

\br

Пусть объект, определяемый уравнением $\dot{x} = \mAx + \mb u$, полностью управляем, а показатель качества имеет вид

\beq{eq:2/2/11}
    \funcF = \frac{1}{2} \int\limits_0^\infty \bigl[ x^T(\tau)\mQ x(\tau) + ru^2(\tau) \bigr]\,d\tau \mbox{.}
\eeq

Полагаем $\mQ$ положительно определенной и $r > 0$. Тогда оптимальное управление~--- $\optU = -(1/r) \mb^T\mP x = -\mk^Tx$, где $\mk^T = \mb^T\mP / r$. Тогда передаточная функция разомкнутой оптимальной системы управления равна (TODO)

\beq{eq:2/2/12}
    \funcT(s) = k^T(s\mI - \mA)^{-1}\mb \mbox{.}
\eeq

\begin{teo}\lbl{teo:2}
    Функция $\funcF(s)$, определяемая уравнением~\ref{eq:2/2/12} обладает тем свойством, что при всех частотах $\omega$ справедливо, что
	\beq{eq:2/2/13}
    	\bigl| 1 + \funcT(j\omega) \bigr| > 1 \mbox{.}
	\eeq
\end{teo}

\strong{Доказательство.}

Заметим, что показатель качества~\ref{eq:2/2/11} можно нормировать так, что $r=1$. Тогда уравнение~\ref{eq:2/2/10} принимает вид\footnote{ В случае одного управляющего воздействия вектор $\mR$ в уравнении~\ref{eq:2/2/10} переходит в скаляр $r$. }

\beq{eq:2/2/14}
    - \mP\mA - \mA^T\mP = \mQ - \mP\mb \mb^T\mP \mbox{.}
\eeq

Прибавляя и вычитая $s\mP$, получим

\beq{eq:2/2/15}
    \mP(s\mI - \mA) + (-s\mI - \mA^T)\mP = \mQ - \mP\mb\mb^T\mP \mbox{.}
\eeq

Передаточная функция объекта от $u$ до $x$ определяется выражением $\mH(s) = (s\mI-\mA)^{-1}\mb$. Если обе стороны уравнения~\vref{eq:2/2/15} предварительно умножить на $\mH^T(-s)$, а затем на $\mH(s)$, то найдем

\beqn
    \mH^T(-s)\mP \mb + \mb^T\mP\mH(s) = \mH^T(-s)[\mQ - \mP\mb\mb^T\mP]\mH(s)
\eeqn

или

\beq{eq:2/2/16}
    \mH^T(-s)\mP\mb + \mH^T(-s)\mP\mb\mb^T\mP\mH(s) + \mb^T\mP\mH(s) = \mH^T(-s)\mQ\mH(s) \mbox{,}
\eeq

так как положительно определенную матрицу $Q$ можно представить в виде (TODO)

\beqn
    \mQ = \mD^T\mLa\mD \mbox{,}
\eeqn

где матрица $\mD$~--- действительная, а матрица $\mLa$~--- действительно, положительно определенная и диагональная.

Уравнение~\ref{eq:2/2/16} с учетом того, что $\mk = \mP\mb$, можно записать следующим образом:

\beq{eq:2/2/17}
    \bigl( 1+\mH^T(-s)\mk \bigr)\bigl( 1+\mk^T\mH(s) \bigr) = 1 + \mH^T(-s)\mD\mLa\mD\mH(s) \mbox{.}
\eeq

Ввиду того, что $\mk^T\mH(s) = \funcT(s)$, при $s = j\omega$ имеем

\beq{eq:2/2/18}
    \bigl| 1 + \funcT(j\omega) \bigr|^2 = 1 + \mH^T(-j\omega)\mD^T\mLa\mD\mH(j\omega) \mbox{.}
\eeq

Так как последний член уравнения~\vref{eq:2/2/15} всегда положителен, то из~\ref{eq:2/2/18} следует, что условие теоремы~\ref{eq:2/2/13} выполнено.\qed

Условие~\ref{eq:2/2/13} можно представить в виде единичной окружности с центром в точке $-1 + j0$, которую годограф $\funcT(j\omega)$ не должен касаться или входить в нее. Это значит, кто какой бы ни была первоначальная передаточная функция объекта $\sff{G}(s)$, оптимальный линейный регулятор путем компенсации будет превращать ее в $\funcT(j\omega)$ с указанными выше свойствами. Другими словами, вследствие строгости условия~\vref{eq:2/2/13} оптимальное уравнение трудно будет осуществить в случае нетривиальных управляемых объектов.

\br

Хотя приведенные выше результаты применимы лишь к системам без элемента сравнения, их можно очень легко распространить на системы с элементами сравнения и входными сигналами, принадлежащими определенному классу. Однако такое обобщение остается за рамками этой работы.



% **********************************************************************************************
\section{Связь с принципом максимума}
% **********************************************************************************************




Введем понятие принципа максимума. Пускай задана система $\dot{x} = f(x, u, t)$, с начальным условием $x(t_1) = x_1$. Необходимо выбрать такую функцию управления $u(t)$ на интервале $t \in [t_1, t_2]$, чтобы

\benum
	\item
		Изображающая точка была переведена из состояния $x_1$ в момент времени $t_1$ в такое состояни в момент времени $t_2$, чтобы первые $m$ ($m \leqslant n$) составляющий текущего вектора состояния $x$ ($x_1, x_2, \ldots, x_m$) совпадали с $m$ составляющих заданного конечного состояния $s_1, s_2, \ldots, s_m$ и чтобы функционал
		\beq{eq:2/3/1}
			\funcF = \int\limits_{t_1}^{t_2} \funcL(x,u,t)\,dt
		\eeq
		достигал бы минимума.
		
	\item
		Были учтены все ограничения, наложенные на $u(t)$; без потери общности можно считать, что $u(t)$ принимает значения внутри $r$-мерного единичного куба, определяемого условием $|u_i(t)| \leqslant 1$ ($i = 1,2,\ldots,r$).
\eenum

В приведенной формулировке некоторые переменные состояния остались свободными в конечный момент времени $t_2$. Полагаем, что функция $f(x, u, t)$ является непрерывной функцией от $u$, кусочно-непрерывной по $t$ и непрерывно дифференцируемой по $x$. Полагаем, что функция $\funcL$ обладает теми же свойствами.

Учтем формулу~\ref{eq:2/3/1} непосредственно в формулировке задачи. Это достигается путем введения дополнительной переменной состояния $x_0$, где

\beq{eq:2/3/2}
    \dot{x}_0 \equiv \funcL(x, u, t) \mbox{.}
\eeq

Определим два $(n+1)$-мерных вектора $x'$ и $f'$ соответственно с составляющими $x_0, x_1, \ldots, x_n$ и $\funcL, f_1, f_2, \ldots, f_n$. Уравнения для расширенной системы можно записать в таком виде

\beq{eq:2/3/3}
    \dot{x} = f'(x', u, t) \mbox{.}
\eeq

Причем $x_0(t_1) = 0$, $x_0(t_2) = \funcF$.

Задачу оптимизации, рассматриваемую в расширенном пространстве размерности $n+1$, можно теперь сформулировать таким образом: в $(n+1)$-мерном пространстве состояний с координатами $x_0, x_1, \ldots, x_n$ найти допустимое управление $\optU(t)$ ($t_1 \leqslant t \leqslant t_2$), которое переводит систему из начального положения $x_0 = 0$, $x = x_1$ в конечное таким образом, что $x_i(t_2) = s_i$ при $i = 1, 2, \ldots, m$, а $x_0(t_2)$ принимает наименьшее значение.

Введем $(n+1)$-мерный вектор $\psi(t)$ и образуем следующую функцию гамильтона от четырех переменных $x'$, $u$, $t$, $\psi'$

\beq{eq:2/3/4}
    H(x', u, t, \psi') \eqdef \psi'^T(t)f'(x', u, t) \mbox{.}
\eeq

Сформулируем теперь \emph{принцип максимума} Понтрягина.

\begin{teo}\lbl{teo:3}
	Если функция $\optU(t)$ определяет оптимальное управление, а $\optX'(t)$~--- оптимальная траектория, соответствующая $\optU(t)$, согласно уравнению~\ref{eq:2/3/3}, то имеется ненулевая непрерывная векторная функция $\psi'(t)$ такая, что
	\benum
		\item
			В любой момент времени $t$ (за исключением, возможно, точек, в которых $f'$ или $u$ являются разрывными) функция Гамильтона вдоль оптимальной траектории $\optX(t)$ достигает максимума. Иначе говоря,
			\beqn
				H(\optX', \optU, t, \psi') \geqslant H(\optX', u, t, \psi') \mbox{.}
			\eeqn
		
		\item
			В любой момент времени $t$ (за исключением, возможно, точек, в которых $f'$ или $u$ являются разрывными) вектор $\psi(t)$ удовлетворяет системе
			\beq{eq:2/3/5}
				\dot{\psi}'(t) = -\partdiff{H(x', \optU, t, \psi')}{x'} \biggm|_{x' = \optX(t)} \mbox{.}
			\eeq
		
		\item
			$\psi_i(t_2) = 0$ при $i= m+1, m+2, \ldots, n$.
		
		\item
			$\psi_0(t_2) \leqslant 0$
	\eenum
\end{teo}

\br

Выражения~\ref{eq:2/1/14} и~\vref{eq:2/1/16} очень похожи на выражения, связанные с максимизацией функции Гамильтона в формулировке задачи оптимального управления на основе принципа максимума (TODO). Так как для любой функции $F$ $\max(-F) = \min F$, то выражение~\ref{eq:2/1/14} можно записать в виде

\beq{eq:2/3/6}
    \partdiff{\optF}{t} = \underset{u(t) \in \Upsilon}{\max} \Bigl\{ -\funcL\bigl( x(u, t), u, t \bigr) - \biggl(\partdiff{\optF}{x}\biggr)^Tf \Bigr\} \mbox{.}
\eeq

Если вдоль оптимальной траектории вектор $-\partlinediff{\optF}{x}$ отождествить с сопряженным вектором $\psi$, то величина, заключенная в фигурных скобках в уравнении~\ref{eq:2/3/6}, является гамильтонианом $H$ для принципа максимума. В этом случае величина $\partlinediff{\optF}{t}$ представляет собой величину $H(\optX, \optU, t, \psi)$ и выполняется 2 условие теоремы~\vref{teo:3}. При этих условиях имеем

\beqarr
    \lbl{eq:2/3/7}
    	\partdiff{\optF}{x} = \psi(t) \mbox{;} \\
    \lbl{eq:2/3/8}
    	\partdiff{\optF}{x} = \funcH \eqdef H(\optX, \optU, t, \psi)
\eeqarr

Таким образом, сопряженный вектор $\psi'$, соответствующий оптимальной траектории, представляет собой вектор, направленный в сторону, противоположную направлению градиент критерия оптимальности $\optF$. Так как вектор градиента направлен в сторону быстрейшего изменения функции, то вектор $\psi$ располагается в каждый момент времени в направлении быстрейшего изменения критерия оптимальности.

Для расширенной системы имеем $H = \psi'^T\dot{x}'$. При этом принцип оптимальности дает $\partlinediff{\optF}{x'} = \psi'$. Итак, условие $\max\limits_{u \in \Omega(t)} H$ в принципе максимума означает, что в расширенном $(n+1)$-мерном пространстве управлений $\optU \in \Upsilon$ следует выбирать таким образом, чтобы в любой момент времени составляющая вектора $\dot{x}$ в направлении наискорейшего убывания величины $\optF$ была максимально большой.

Из выражения~\ref{eq:2/3/8} видно, что оптимальная функция Гамильтона $\funcH$ равна скорости изменения критерия оптимальности при отсчете времени от выбранной начальной точки. Поэтому ясно, почему в случае оптимального по быстродействию управления стационарным объектом функция $\funcH$ должна равняться нулю. Последнее видно из рассмотрения величины $\partlinediff{\optF(x, t)}{t}$. Напомним, что $t$ в $\optF(x, t)$ представляет собой начальное время. При фиксированной начальной точке оптимальное время достижения любой данной точки не зависит от начального времени для стационарного объекта управления, а следовательно $\funcH = 0$.

Иными словами, всякий раз, когда управляемый объект и функция стоимости $\funcL$ не зависит явно от времени, а конечное время $t_2$ не фиксировано, то $\partlinediff{\optF}{t}$ будет всегда равняться нулю, следовательно во всех этих случаях $\funcH = 0$.

Выражая уравнение Беллмана через гамильтониан $H$, можно записать

\beq{eq:2/3/9}
    \partdiff{\optF}{t} - H\biggl( \optX, \optU, t, \partdiff{\optF}{x} \biggr) = 0 \mbox{.}
\eeq

Это уравнение совпадает с уравнением Гамильтона--Якоби (TODO).

\br

Предположим, требуется найти оптимальное линейное управление с обратной связью для системы с точно определенным входным сигналом $z(t)$. Цель управления состоит в том, чтобы удерживать выходной сигнал близким к входному, не затрачивая при этом чрезмерно много энергии. Задачу можно сформулировать следующим образом.

Пусть выходной сигнал объекта $\dot{x} = \mA(t)x + \mB(t)u$ определяется как $y(t) = \mC(t)x(t)$, где векторы $x$ и $y$ соответственно $n$- и $m$-мерны. Пусть входной сигнал есть $m$-мерный вектор $z(t)$, а ошибка системы равна $e(t) = z(t) - y(t)$. Соответствующий показатель качества имеет вид

\beq{eq:2/3/10}
    \funcF = e^T(t_2) \mM e(t_2) + \frac{1}{2} \int\limits_{t_1}^{t_2} \bigl( e^T(\tau) \mQ(\tau) e(\tau) + u^T(\tau)\mR(\tau)u(\tau) \bigr)\,d\tau \mbox{;}
\eeq

его необходимо минимизировать, найдя оптимальное управление $\optU(x, t)$.

Определим гамильтониан

\beq{eq:2/3/10}
\begin{split}
    H & = -\frac{1}{2} \bigl( z(t) - \mC(t)x(t) \bigr)^T\mQ(t)\bigl( z(t) - \mC(t)x(t) \bigr) - \frac{1}{2} \bigl( u^T(t)\mR(t)u(t) \bigr) + \\
      & + \biggl( \bigl(\mA(t)x(t) \bigr)^T + \bigl(\mB(t)x(t) \bigr)^T \biggr)\psi(t)
\end{split}
\eeq

Оптимальную функцию управления $\optU(t)$ найдем из уравнения

\beqn
	\partdiff{H}{u}\biggm|_{u = \optU} = 0 \mbox{,}
\eeqn

откуда

\beq{eq:2/3/11}
    \optU(t) = -\mR^{-1}\mB^T(t)\psi(t) = -\mR^{-1}(t)\mB^T(t)\partdiff{\optF(x, t)}{x} \mbox{.}
\eeq

Это имеет смысл при условии существования обратной матрицы $\mR^{-1}(t)$ для всех $t$. Таким образом, удалось получить результат, аналогичный~\vref{eq:2/2/5}, но из других соображений.



% **********************************************************************************************
\section{Достаточное условие оптимальности}
% **********************************************************************************************



Докажем теорему о том, что уравнение Беллмана представляет собой условие оптимальности (TODO).

\begin{teo}\lbl{teo:4}
	Рассмотрим систему $\dot{x} = f(x, u, t)$, начинающую движение из начального состояния $x(t_1) = x_1$ на интервале времени $t \in [t_1, t_2]$. Требуется найти управление $u(t) = \optU(t)$, доставляющее минимум функционалу~\vref{eq:2/1/1}.
	
	Пусть область цели представляет собой открытое множество $\calf{S}$, а конечный момент времени $t_2$ не задан. Обозначим через $\calf{V}$ открытую область, в которой функция $\funcV(x, t)$ определяется следующим образом
	
	\benum
		\item
			$\partlinediff{\funcV}{t}$ непрерывная по $x$ и $t$, а $\partlinediff{\funcV}{x}$ или непрерывная по $x$ и $t$, или удовлетворяет условию
			\beq{eq:2/4/1}
    			\lim\limits_{t \to \tau-0} \Bigl[ \biggl(\partdiff{\funcV}{x}\biggr)^Tf \Bigr] = \lim\limits_{t \to \tau+0} \Bigl[ \biggl(\partdiff{\funcV}{x}\biggr)^Tf \Bigr]
			\eeq
			в любой момент времени $t = \tau$, когда $\partlinediff{\funcV}{x}$ или $f(x, u, t)$ разрывны.
			
		\item
			Для каждого $x \in \calf{V}$ в каждый момент времени $t$ функция Гамильтона $H(x, u, t, \partlinediff{\funcV}{x})$ имеет абсолютный минимум при $u = \optU$ из множества допустимых функций управления. Кроме того, управление $\optU(t)$ определяет единственную траекторию системы $\optX(t)$.
			
		\item
			На конечном множестве $\calf{S}$ $\funcV(x, t) = 0$.
	\eenum
	
	Тогда $\funcV(x, t) = \optF(x, t)$ при всех допустимых функциях управления, которые переводят изображающую точку из состояния $x_1$ в $\calf{S}$, не покидая области $\calf{V}$. Далее оптимальное управление с обратной связью $\optU(x, t)$ можно получить, решая соответствующее уравнение Беллмана.
\end{teo}


\strong{Доказательство.}

В соответствии с условиями 1 и 2 теоремы можно написать

\beq{eq:2/4/2}
\begin{split}
    0 =& \partdiff{\funcV}{t} + \Bigl[ \biggl(\partdiff{\funcV}{x}\biggr)^T f(x, \optU, t) + \funcL(x, \optU, t) \Bigr] < \\
       & < \partdiff{\funcV}{t} + \Bigl[ \biggl(\partdiff{\funcV}{x}\biggr)^T f(x, u, t) + \funcL(x, u, t) \Bigr]
\end{split}
\eeq

Проинтегрировав левую часть~\ref{eq:2/4/2} вдоль траектории $\optX(t)$ от $t_1$ до оптимального конечного момента $t_2^{*}$, получим

\beq{eq:2/4/3}
\begin{split}
    \int\limits_{t_1}^{t_2} \Bigl[ \partdiff{\funcV(\optX, t)}{t} +& \biggl(\partdiff{\funcV(\optX, t)}{x}\biggr)^T f(\optX, \optU, t) \Bigr]\,dt + \int\limits_{t_1}^{t_2} \funcL(\optX, \optU, t)\,dt = \\
    &= \int\limits_{t_1}^{t_2^{*}} \biggl[ \genericdiff{\funcV}{t} \biggr]_{\optU, t}\,dt + \int\limits_{t_1}^{t_2^{*}} \funcL(\optX, \optU, t)\,dt = 0 \mbox{.}
\end{split}
\eeq

Рассмотрим теперь интеграл

\beq{eq:2/4/4}
    W \eqdef \int\limits_{t_1}^{t_2^{*}} \Bigl[ \partdiff{\funcV}{t} + \biggl(\partdiff{\funcV}{x}\biggr)^T f(x, u, t) + \funcL(x, u, t) \Bigr]\,dt \mbox{.}
\eeq

Далее допустим, что сочетание $\optU$ и $\optX$ является единственным, которое доставляет абсолютный минимум величине $W$, равный в соответствии с условием~\ref{eq:2/4/3} нулю. Если это неверно, то найдутся другие $u(t) \neq \optU(t)$ и $x(t) \neq \optX(t)$, которые сделают выражение~\ref{eq:2/4/4} равным нулю. Однако из условия~\ref{eq:2/4/2} следует, что подынтегральное выражение~\ref{eq:2/4/4} всегда положительно. Таким образом, чтобы обратить $W$ в нуль, указанное подынтегральное выражение должно равняться нулю на всем интервале $[t_1, t_2]$. Из условий~\ref{eq:2/4/2} следует, что сделать это может лишь пара $\optU(t)$ и $\optX(t)$.

Таким образом, теорема~\vref{teo:4} доказана. \qed



% **********************************************************************************************
\section{Область применимости результатов}
% **********************************************************************************************



Сделаем ряд замечаний относительно оптимальных линейных законов управления. Неверным является суждение, что во всех конкретных случаях удается свести системы к стандартной форме и применить формулы, приведенные в этом разделе. С этим классом задач связан ряд серьезных трудностей.

Во-первых, критерий~\vref{eq:2/2/1} зачастую вызывает сомнения в целесообразности применения. Не существует обоснованного способа выбора нужных весовых матриц $\mM$, $\mQ(t)$ и $\mR(t)$. Очень часто соответствующие матрицы находят из эвристических соображений, методом проб и ошибок, причем наиболее удовлетворительную переходную характеристику определяют на глаз.

Во-вторых, закон оптимального управления с обратной связью использует все переменные состояния, а это обычно означает, что выход и $n-1$ его производных нужно измерять без ошибок, что в большинстве реальных систем попросту невозможно.

В-третьих, при отсутствии входного сигнала матрицу обратной связи $\mP(t)$ необходимо получить путем решения нелинейной системы уравнений~\vref{eq:2/2/7}. Обычно это выполняется численными методами. С инженерных позиций этот метод малоудовлетворителен не только потому, что для систем высокого порядка трудоемкость и объем вычисления существенно возрастают, но также потому, что полученных результат представляет собой совокупность $n(n+1)/2$ функций времени, которые являются коэффициентами усиления в канае обратной связи. Применительно к нестационарным системам правильность получаемых результатов вызывает сомнение, и любая попытка проверить полученный результат путем использования уравнения Беллмана может оказаться в высшей степени трудоемкой.

В-четвертых, условие~\vref{eq:2/2/13}, являющееся по существу условием оптимальности для стационарных систем, накладывает исключительно жесткие ограничения, практически делая невозможным расчет сколько-нибудь сложных систем.
